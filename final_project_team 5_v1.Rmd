---
title: "final project team 5"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
date: "`r Sys.Date()`"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(ezids)
library(dplyr)
library(readr)
library(tidyr)
library(knitr)
library(magrittr)

df_2016<-data.frame(read.csv("Arrests 2016 Public.csv"))
df_2017<-data.frame(read.csv("Arrests 2017 Public.csv"))
df_2018<-data.frame(read.csv("Arrests by Year, 2018.csv"))
df_2019<-data.frame(read.csv("Arrests by Year, 2019.csv"))
df_2020<-data.frame(read.csv("Arrests by Year 2020.csv"))
df_2021<-data.frame(read.csv("2021 Adult Arrests.csv"))

# convert format
df_2018$Arrest.Date <- as.Date(df_2018$Arrest.Date, format = "%m/%d/%Y") %>% format()
df_2019$Arrest.Date <- as.Date(df_2019$Arrest.Date, format = "%m/%d/%Y") %>% format()
df_2020$Arrest.Date <- as.Date(df_2020$Arrest.Date, format = "%m/%d/%Y") %>% format()
df_2021$Arrest.Date <- as.Date(df_2021$Arrest.Date, format = "%Y/%m/%d") %>% format()

#bind df_2016 and df_2017, and delete some columns
df_16_17 <- rbind(df_2016, df_2017)[,-c(5,6,15,17:21,23:26)]
names(df_16_17)[c(13,14)] <- c('Arrest.Location.District','Offense.Location.District')   #rename columns

#bind df_2018 - df_2021, and delete some columns
df_18_21 <- rbind(df_2018, df_2019, df_2020, df_2021)[,-c(5,6,15,17:21,23:26)] 

DF<-rbind(df_16_17,df_18_21)

# remove abnormalities
DF <- DF[!DF$Age>=100,]

# replace dots with underscore for clarity sake, i think..
names(DF) = gsub("[.]", "_", names(DF))

# most likely "UNK" is the same as "Unknown", so we can change this
DF$Defendant_Race[DF$Defendant_Race == 'UNK'] <- 'UNKNOWN'
#unique(DF$Defendant_Race) - check that it changed

#same issue, "unk" is very likely "unknown", so change it.
DF$Defendant_Sex[DF$Defendant_Sex == 'UNK'] <- 'UNKNOWN'
#unique(DF$Defendant_Sex) - check that it changed

# Arrest category -  4 different types of Fraud & Financial crimes , 3 types of Release Violations/Fugitive -- group them into one.

DF$Arrest_Category = gsub("Fraud and Financial Crimes.*","Fraud and Financial Crimes", DF$Arrest_Category)

DF$Arrest_Category = gsub("Release Violations/Fugitive.*","Release Violations/Fugitive",DF$Arrest_Category)

#get month and day variables.. might be interesting, who knows?
DF <- separate(DF, col = Arrest_Date, into = c("Year","Month","Day"), sep = "-", remove = FALSE, fill="left")
#remove the new year column formed, it is redundant.. we already have Year column
DF = DF[,-4]

library(lubridate)
# Factorize some variables
DF$Arrest_Year = as.factor(DF$Arrest_Year)
DF$Month = as.factor(DF$Month)
DF$Day = as.factor(DF$Day)
DF$Defendant_Race = as.factor(DF$Defendant_Race)
DF$Defendant_Sex = as.factor(DF$Defendant_Sex)
DF$Arrest_Location_District = as.factor(DF$Arrest_Location_District)
DF$Offense_Location_District = as.factor(DF$Offense_Location_District)
# convert to date format
DF$Arrest_Date = as.Date(DF$Arrest_Date)
# Day format
DF$Day = day(DF$Arrest_Date)
# i want to create a week-day variable
DF$Weekday = weekdays(DF$Arrest_Date)
DF$Weekday = factor(DF$Weekday, levels = as.character(wday(c(2:7,1), label=TRUE, abbr=FALSE)))

# convert crime types to factors
DF$Arrest_Category = as.factor(DF$Arrest_Category)

DF_WM <- subset(DF, subset = Defendant_Race=='WHITE' & Defendant_Sex=='MALE')

```


```{r}
# create dataframe having "Category", "Month", "District", "Year", and "Count" as its column
DF_WM2 <- DF_WM
DF_WM2$Count <- c(rep(1,nrow(DF_WM2)))

DF_WM2 = aggregate(x=DF_WM2[c("Count")], 
                   by=list(DF_WM2$Arrest_Category, DF_WM2$Month,
                           DF_WM2$Offense_Location_District, DF_WM2$Arrest_Year),
                   sum)

colnames(DF_WM2)[1:4] = c("Category", "Month", "District", "Year")
DF_WM2 = subset(DF_WM2, DF_WM2$District != '#N/A')
```

```{r}
# create a data frame with "District", "Month", and "Count" as columns for the specified crime.

createDF <- function(df, cat, y){
  df_temp = subset(df, Category==cat & Year==y, select=c(District, Month, Count))
  M <- c('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12')
  D <- c('1D','2D','3D','4D','5D','6D','7D' )
  for(m in M){
    for(d in D){
      if(nrow(df_temp[df_temp$Month==m & df_temp$District==d,])==0){
        add_data = c(d, m, 0)
        df_temp = rbind(df_temp, add_data)
      }
    }
  }
  df_temp$Count = as.integer(df_temp$Count)
  
  return(df_temp)
}
```



# Log-linear model 
I calculated $\lambda$ without considering the effects of "Month", "Weekday" and "District" in the midterm project. For final project, I will check these effects on the counts of each major crime  using a Log-linear model.

In a Log-linear model, response variable is a count of some occurrence that follows a Poisson distribution, and explanatory variables are categorical variables. The expected counts $\mu_{ij}$ is modeled as follows:
$$ \log(\mu_{ij})=\lambda + \lambda^A_i + \lambda^B_j + \lambda^{AB}_{ij}, $$
where $\lambda$ is a ground effect, $\lambda^A_i$ is the main effect of categorical variable A, and $\lambda^{AB}_{ij}$ is the interaction effect of A and B (if any).
  

## Simple Assault  
### Modeled on a yearly basis
### Models  
I will model the relationship between the counts of "Simple Assault" and categorical variables ("District" and "Month") using independence models:
$${\rm{Model \ 1:}} \ \log(\mu_{ij})=\lambda.$$
$${\rm{Model \ 2:}} \ \log(\mu_{ij})=\lambda + \lambda^{District}_i.$$
$${\rm{Model \ 3:}} \ \log(\mu_{ij})=\lambda + \lambda^{Month}_j.$$
$${\rm{Model \ 4:}} \ \log(\mu_{ij})=\lambda + \lambda^{District}_i + \lambda^{Month}_j.$$
I also create a saturated model:
$${\rm{Model \ 5:}} \ \log(\mu_{ij})=\lambda + \lambda^{District}_i + \lambda^{Month}_j + \lambda^{District,Month}_{ij}.$$


```{r, , include=FALSE}
# 2016

DF_SA_2016 = createDF(DF_WM2, 'Simple Assault', '2016')
model1.sa.2016 <- glm(Count ~ 1, data = DF_SA_2016, family = poisson)
model2.sa.2016 <- glm(Count ~ District, data = DF_SA_2016, family = poisson)
model3.sa.2016 <- glm(Count ~ Month, data = DF_SA_2016, family = poisson)
model4.sa.2016 <- glm(Count ~ District + Month, data = DF_SA_2016, family = poisson)
model5.sa.2016 <- glm(Count ~ District * Month, data = DF_SA_2016, family = poisson)
summary(model1.sa.2016)
summary(model2.sa.2016)
summary(model3.sa.2016)
summary(model4.sa.2016)
summary(model5.sa.2016)
```

```{r, , include=FALSE}
# 2017

DF_SA_2017 = createDF(DF_WM2, 'Simple Assault', '2017')
model1.sa.2017 <- glm(Count ~ 1, data = DF_SA_2017, family = poisson)
model2.sa.2017 <- glm(Count ~ District, data = DF_SA_2017, family = poisson)
model3.sa.2017 <- glm(Count ~ Month, data = DF_SA_2017, family = poisson)
model4.sa.2017 <- glm(Count ~ District + Month, data = DF_SA_2017, family = poisson)
model5.sa.2017 <- glm(Count ~ District * Month, data = DF_SA_2017, family = poisson)
summary(model1.sa.2017)
summary(model2.sa.2017)
summary(model3.sa.2017)
summary(model4.sa.2017)
summary(model5.sa.2017)
```

```{r, , include=FALSE}
# 2018

DF_SA_2018 = createDF(DF_WM2, 'Simple Assault', '2018')
model1.sa.2018 <- glm(Count ~ 1, data = DF_SA_2018, family = poisson)
model2.sa.2018 <- glm(Count ~ District, data = DF_SA_2018, family = poisson)
model3.sa.2018 <- glm(Count ~ Month, data = DF_SA_2018, family = poisson)
model4.sa.2018 <- glm(Count ~ District + Month, data = DF_SA_2018, family = poisson)
model5.sa.2018 <- glm(Count ~ District * Month, data = DF_SA_2018, family = poisson)
summary(model1.sa.2018)
summary(model2.sa.2018)
summary(model3.sa.2018)
summary(model4.sa.2018)
summary(model5.sa.2018)
```

```{r, , include=FALSE}
# 2019

DF_SA_2019 = createDF(DF_WM2, 'Simple Assault', '2019')
model1.sa.2019 <- glm(Count ~ 1, data = DF_SA_2019, family = poisson)
model2.sa.2019 <- glm(Count ~ District, data = DF_SA_2019, family = poisson)
model3.sa.2019 <- glm(Count ~ Month, data = DF_SA_2019, family = poisson)
model4.sa.2019 <- glm(Count ~ District + Month, data = DF_SA_2019, family = poisson)
model5.sa.2019 <- glm(Count ~ District * Month, data = DF_SA_2019, family = poisson)
summary(model1.sa.2019)
summary(model2.sa.2019)
summary(model3.sa.2019)
summary(model4.sa.2019)
summary(model5.sa.2019)
```

```{r, , include=FALSE}
# 2020

DF_SA_2020 = createDF(DF_WM2, 'Simple Assault', '2020')
model1.sa.2020 <- glm(Count ~ 1, data = DF_SA_2020, family = poisson)
model2.sa.2020 <- glm(Count ~ District, data = DF_SA_2020, family = poisson)
model3.sa.2020 <- glm(Count ~ Month, data = DF_SA_2020, family = poisson)
model4.sa.2020 <- glm(Count ~ District + Month, data = DF_SA_2020, family = poisson)
model5.sa.2020 <- glm(Count ~ District * Month, data = DF_SA_2020, family = poisson)
summary(model1.sa.2020)
summary(model2.sa.2020)
summary(model3.sa.2020)
summary(model4.sa.2020)
summary(model5.sa.2020)
```

```{r, include=FALSE}
# 2021

DF_SA_2021 = createDF(DF_WM2, 'Simple Assault', '2021')
model1.sa.2021 <- glm(Count ~ 1, data = DF_SA_2021, family = poisson)
model2.sa.2021 <- glm(Count ~ District, data = DF_SA_2021, family = poisson)
model3.sa.2021 <- glm(Count ~ Month, data = DF_SA_2021, family = poisson)
model4.sa.2021 <- glm(Count ~ District + Month, data = DF_SA_2021, family = poisson)
model5.sa.2021 <- glm(Count ~ District * Month, data = DF_SA_2021, family = poisson)
summary(model1.sa.2021)
summary(model2.sa.2021)
summary(model3.sa.2021)
summary(model4.sa.2021)
summary(model5.sa.2021)
```

### Model selection  
#### Deviance
I will use "residual deviance" to test the below hypothesis at a siginificance level $\alpha=0.05$:
$$H_0: \ \rm{Reduced \ model \ is \ true.}$$
$$H_1: \ \rm{Satureated \ model \ (Model \ 5) \ is \ true}$$
To test the hypothesis, I will calculate p-value:  
  
  
**2016**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.sa.2016)$deviance` | `r summary(model1.sa.2016)$df.residual` | `r pchisq(summary(model1.sa.2016)$deviance, summary(model1.sa.2016)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.sa.2016)$deviance` | `r summary(model2.sa.2016)$df.residual` | `r pchisq(summary(model2.sa.2016)$deviance, summary(model2.sa.2016)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.sa.2016)$deviance` | `r summary(model3.sa.2016)$df.residual` | `r pchisq(summary(model3.sa.2016)$deviance, summary(model3.sa.2016)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.sa.2016)$deviance` | `r summary(model4.sa.2016)$df.residual` | `r pchisq(summary(model4.sa.2016)$deviance, summary(model4.sa.2016)$df.residual, lower.tail=FALSE)` |
  
For Model 2 and Model 4, $H_0$ is not rejected.

  
**2017**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.sa.2017)$deviance` | `r summary(model1.sa.2017)$df.residual` | `r pchisq(summary(model1.sa.2017)$deviance, summary(model1.sa.2017)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.sa.2017)$deviance` | `r summary(model2.sa.2017)$df.residual` | `r pchisq(summary(model2.sa.2017)$deviance, summary(model2.sa.2017)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.sa.2017)$deviance` | `r summary(model3.sa.2017)$df.residual` | `r pchisq(summary(model3.sa.2017)$deviance, summary(model3.sa.2017)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.sa.2017)$deviance` | `r summary(model4.sa.2017)$df.residual` | `r pchisq(summary(model4.sa.2017)$deviance, summary(model4.sa.2017)$df.residual, lower.tail=FALSE)` |
  
For Model 2 and Model 4, $H_0$ is not rejected.
  
**2018**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.sa.2018)$deviance` | `r summary(model1.sa.2018)$df.residual` | `r pchisq(summary(model1.sa.2018)$deviance, summary(model1.sa.2018)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.sa.2018)$deviance` | `r summary(model2.sa.2018)$df.residual` | `r pchisq(summary(model2.sa.2018)$deviance, summary(model2.sa.2018)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.sa.2018)$deviance` | `r summary(model3.sa.2018)$df.residual` | `r pchisq(summary(model3.sa.2018)$deviance, summary(model3.sa.2018)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.sa.2018)$deviance` | `r summary(model4.sa.2018)$df.residual` | `r pchisq(summary(model4.sa.2018)$deviance, summary(model4.sa.2018)$df.residual, lower.tail=FALSE)` |
  
For Model 4, $H_0$ is not rejected.
  
**2019**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.sa.2019)$deviance` | `r summary(model1.sa.2019)$df.residual` | `r pchisq(summary(model1.sa.2019)$deviance, summary(model1.sa.2019)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.sa.2019)$deviance` | `r summary(model2.sa.2019)$df.residual` | `r pchisq(summary(model2.sa.2019)$deviance, summary(model2.sa.2019)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.sa.2019)$deviance` | `r summary(model3.sa.2019)$df.residual` | `r pchisq(summary(model3.sa.2019)$deviance, summary(model3.sa.2019)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.sa.2019)$deviance` | `r summary(model4.sa.2019)$df.residual` | `r pchisq(summary(model4.sa.2019)$deviance, summary(model4.sa.2019)$df.residual, lower.tail=FALSE)` |

For Model 2, $H_0$ is not rejected.
  
**2020**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.sa.2020)$deviance` | `r summary(model1.sa.2020)$df.residual` | `r pchisq(summary(model1.sa.2020)$deviance, summary(model1.sa.2020)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.sa.2020)$deviance` | `r summary(model2.sa.2020)$df.residual` | `r pchisq(summary(model2.sa.2020)$deviance, summary(model2.sa.2020)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.sa.2020)$deviance` | `r summary(model3.sa.2020)$df.residual` | `r pchisq(summary(model3.sa.2020)$deviance, summary(model3.sa.2020)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.sa.2020)$deviance` | `r summary(model4.sa.2020)$df.residual` | `r pchisq(summary(model4.sa.2020)$deviance, summary(model4.sa.2020)$df.residual, lower.tail=FALSE)` |
  
$H_0$ is rejected for all models.
  
**2021**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.sa.2021)$deviance` | `r summary(model1.sa.2021)$df.residual` | `r pchisq(summary(model1.sa.2021)$deviance, summary(model1.sa.2021)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.sa.2021)$deviance` | `r summary(model2.sa.2021)$df.residual` | `r pchisq(summary(model2.sa.2021)$deviance, summary(model2.sa.2021)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.sa.2021)$deviance` | `r summary(model3.sa.2021)$df.residual` | `r pchisq(summary(model3.sa.2021)$deviance, summary(model3.sa.2021)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.sa.2021)$deviance` | `r summary(model4.sa.2021)$df.residual` | `r pchisq(summary(model4.sa.2021)$deviance, summary(model4.sa.2021)$df.residual, lower.tail=FALSE)` |
  
For Model 2 and Model 4, $H_0$ is not rejected.


#### Likelihood Ratio Tests  
For the 2016, 2017 and 2021 data, Model 2 and Model 4 remained as candidates. If there is no significant difference between Model 2 and Model 4, then Model 2, the simpler model, is preferred. Therefore, I will perform likelihood ratio tests on the following hypotheses to select the model.  
$$H_0: \ \rm{Model \ 2 \ and \ Model \ 4 \ fit \ the \ data \ equally \ well.}$$
$$H_1: \ \rm{Model \ 4 \ fits \ the \ data \ better \ than \ Model \ 2.}$$

**2016**  
```{r, warning=FALSE, message=FALSE}
library("lmtest")
lrtest(model2.sa.2016, model4.sa.2016)
```

$H_0$ is not rejected, so I choose Model 2.  
  
  
**2017**  
```{r}
lrtest(model2.sa.2017, model4.sa.2017)
```

$H_0$ is not rejected, so I choose Model 2.
  
  
**2021**  
```{r}
lrtest(model2.sa.2021, model4.sa.2021)
```

$H_0$ is rejected, so I choose Model 4.  

### Best Models  

| Year | Best Model |
|:-:|:-:|
|2016|Model 2|
|2017|Model 2|
|2018|Model 4|
|2019|Model 2|
|2020|Model 5|
|2021|Model 4| 
  
#### Parameters  
**2016**
```{r}
xkabledply(model2.sa.2016)
```


**2017**
```{r}
xkabledply(model2.sa.2017)
```


**2018**
```{r}
xkabledply(model4.sa.2018)
```


**2019**
```{r}
xkabledply(model2.sa.2019)
```


**2020**
```{r}
xkabledply(model5.sa.2020)
```


**2021**
```{r}
xkabledply(model4.sa.2021)
```

### Modeled before and after COVID-19
### Weekday, District
```{r}
# create dataframe with "Category", "District", "Weekend"
DF_WM3 <- DF_WM
DF_WM3$Count <- c(rep(1,nrow(DF_WM3)))

# split the data into pre-COVID and post-COVID
DF_preCOVID = subset(DF_WM3, Arrest_Year %in% c(2016,2017,2018,2019))
DF_postCOVID = subset(DF_WM3, Arrest_Year %in% c(2020,2021))

# create dataframe with "Category", "District", "Weekend"
DF_preCOVID = aggregate(x=DF_preCOVID[c("Count")],
                           by=list(DF_preCOVID$Arrest_Category,
                                   DF_preCOVID$Offense_Location_District,
                                   DF_preCOVID$Weekday),
                           sum)
DF_postCOVID = aggregate(x=DF_postCOVID[c("Count")],
                            by=list(DF_postCOVID$Arrest_Category,
                                    DF_postCOVID$Offense_Location_District,
                                    DF_postCOVID$Weekday),
                            sum)
colnames(DF_preCOVID)[1:3] = c("Category", "District", "Weekday")
colnames(DF_postCOVID)[1:3] = c("Category", "District", "Weekday")

DF_preCOVID %>% subset(., District != '#N/A') %>% subset(., District != 'Unk') %>% subset(., District != 'UNKNOWN') -> DF_preCOVID

DF_postCOVID %>% subset(., District != '#N/A') %>% subset(., District != 'Unk') %>% subset(., District != 'UNKNOWN') -> DF_postCOVID

```


```{r}
DF_preCOVID_SA = subset(DF_preCOVID, Category == 'Simple Assault')
DF_postCOVID_SA = subset(DF_postCOVID, Category == 'Simple Assault')
```


### Models

```{r, include=FALSE}
# pre-COVID

model1.pre.sa <- glm(Count ~ 1, data = DF_preCOVID_SA, family = poisson)
model2.pre.sa <- glm(Count ~ District, data = DF_preCOVID_SA, family = poisson)
model3.pre.sa <- glm(Count ~ Weekday, data = DF_preCOVID_SA, family = poisson)
model4.pre.sa <- glm(Count ~ District + Weekday, data = DF_preCOVID_SA, family = poisson)
model5.pre.sa <- glm(Count ~ District * Weekday, data = DF_preCOVID_SA, family = poisson)
summary(model1.pre.sa)
summary(model2.pre.sa)
summary(model3.pre.sa)
summary(model4.pre.sa)
summary(model5.pre.sa)
```

```{r, include=FALSE}
# post-COVID

model1.post.sa <- glm(Count ~ 1, data = DF_postCOVID_SA, family = poisson)
model2.post.sa <- glm(Count ~ District, data = DF_postCOVID_SA, family = poisson)
model3.post.sa <- glm(Count ~ Weekday, data = DF_postCOVID_SA, family = poisson)
model4.post.sa <- glm(Count ~ District + Weekday, data = DF_postCOVID_SA, family = poisson)
model5.post.sa <- glm(Count ~ District * Weekday, data = DF_postCOVID_SA, family = poisson)
summary(model1.post.sa)
summary(model2.post.sa)
summary(model3.post.sa)
summary(model4.post.sa)
summary(model5.post.sa)
```

### Model selection  
#### Deviance  
**pre-COVID**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.pre.sa)$deviance` | `r summary(model1.pre.sa)$df.residual` | `r pchisq(summary(model1.pre.sa)$deviance, summary(model1.pre.sa)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.pre.sa)$deviance` | `r summary(model2.pre.sa)$df.residual` | `r pchisq(summary(model2.pre.sa)$deviance, summary(model2.pre.sa)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.pre.sa)$deviance` | `r summary(model3.pre.sa)$df.residual` | `r pchisq(summary(model3.pre.sa)$deviance, summary(model3.pre.sa)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.pre.sa)$deviance` | `r summary(model4.pre.sa)$df.residual` | `r pchisq(summary(model4.pre.sa)$deviance, summary(model4.pre.sa)$df.residual, lower.tail=FALSE)` |
  
$H_0$ is rejected for all models.

  
**post-COVID**  

| Model | Deviance | df | p-value |
|:-:|:-:|:-:|:-:|
| Model 1 | `r summary(model1.post.sa)$deviance` | `r summary(model1.post.sa)$df.residual` | `r pchisq(summary(model1.post.sa)$deviance, summary(model1.post.sa)$df.residual, lower.tail=FALSE)` | 
| Model 2 | `r summary(model2.post.sa)$deviance` | `r summary(model2.post.sa)$df.residual` | `r pchisq(summary(model2.post.sa)$deviance, summary(model2.post.sa)$df.residual, lower.tail=FALSE)` |
| Model 3 | `r summary(model3.post.sa)$deviance` | `r summary(model3.post.sa)$df.residual` | `r pchisq(summary(model3.post.sa)$deviance, summary(model3.post.sa)$df.residual, lower.tail=FALSE)` |
| Model 4 | `r summary(model4.post.sa)$deviance` | `r summary(model4.post.sa)$df.residual` | `r pchisq(summary(model4.post.sa)$deviance, summary(model4.post.sa)$df.residual, lower.tail=FALSE)` |
  
For Model 4, $H_0$ is not rejected.

### Best Models
#### Parameters  
**pre-COVID**
```{r}
xkabledply(model5.pre.sa)
```


**post-COVID**
```{r}
xkabledply(model4.post.sa)
```

