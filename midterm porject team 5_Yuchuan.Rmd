---
title: "Midterm project Crime data"
author: "Team 5"
# date: "today"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Crime Data in DC area

```{r}

library(ggplot2)
library(ezids)
library(dplyr)
library(readr)
```

### read data
Read the data .CSV files of adults arrest in DC area from 2016-2021
```{r }

df_2016<-data.frame(read.csv("Arrests 2016 Public.csv"))[,1:14]
df_2017<-data.frame(read.csv("Arrests 2017 Public.csv"))[,1:14]
df_2018<-data.frame(read.csv("Arrests by Year, 2018.csv"))[,1:14]
df_2019<-data.frame(read.csv("Arrests by Year, 2019.csv"))[,1:14]
df_2020<-data.frame(read.csv("Arrests by Year 2020.csv"))[,1:14]
df_2021<-data.frame(read.csv("2021 Adult Arrests.csv"))[,1:14]
```
Note that the colnames of df_2016 and df_2017 are not the same with others. But those indices are just about arrest location which is not what we are investigating. Therefore I just combined them by the same indices that we need. (A-N columns)
##Merge Multiple CSV Files
bind by rows

```{r}


DF<-rbind(df_2016,df_2017,df_2018,df_2019,df_2020,df_2021)
#colnames(DF)
xkablesummary(DF)
```

colnames
```{r}
colnames(DF)
```
### Sort data
**There is no outliers, since our observations are not values, just all nominals**

find NaN
```{r}
sum_age<-sum(is.nan(DF$Age))
sum_year<-sum(is.nan(DF$Arrest.Year))
sum_race<-sum(is.nan(DF$Defendant.Race))
sum_sex<-sum(is.nan(DF$Defendant.Sex))
sum_category<-sum(is.nan(DF$Arrest.Category))
sum_nan<-sum_age+sum_race+sum_sex+sum_category+sum_year
sum_nan
```
(There is too many *"unknown"*in defendant Ethnicity, so I think it is ok that we consider only the Defendant Race)
The sum of NaN in the columns of interest (**"Year"**,**"Age"**, **"Defendant race/sex"**, **"Arrest Category"**) is `r sum_nan`


factor by years
```{r}
#DF
#DF[,2] = as.factor(DF$Arrest.Year)
#DF[,10] = as.factor(DF$Defendant.Race)
#DF[,12] = as.factor(DF$Defendant.Sex)
#DF[,13] = as.factor(DF$Defendant.Category)
head(DF)
```
Age distribution
```{r}
barcolors = c("green", "violet", "orange", "blue", "pink", "red", "yellow", "cyan")

hist(DF$Age, main = "Age distribution",  col=barcolors,xlab="Age", breaks = 10)
ttest95_age = t.test(x=DF$Age, conf.level=0.95 )
#ttest95_age$conf.int
```
The T-test(95%) for **"Age"** is `r ttest95_age$conf.int``

The trend of the **Total Crimes** between 2016-2021
```{r}
plot(c(seq(2016, 2021, by=1)),c(nrow(df_2016),nrow(df_2017),nrow(df_2018),nrow(df_2019),nrow(df_2020),nrow(df_2021)), xlab="X-axis label", ylab="y-axix label",col='violet',type='o',lwd=1,lty=1)
title(main ="Crime Trend in DC")
```

```{r}

counts <- table(DF$Defendant.Sex)
barplot(counts, main="Sex distribution of all years",
  xlab="Sex", col=c("darkblue","red"),
  legend = c("Sex"), beside=TRUE)
```
Drop the rows with "uknown(UNK)" and "FEMALE", since we are focus only on **"MALE"** crimes.

```{r}
xx<-which(DF$Defendant.Sex == "UNK")
xxx<-which(DF$Defendant.Sex == "UNKNOWN")
xxxx<-which(DF$Defendant.Sex == "FEMALE")
DF2<- DF[-c(xx,xxx,xxxx), ]
head(DF2)[,10:14]
```
**Race distribtion**
```{r}
counts <- table(DF2$Defendant.Race)
barplot(counts,las=3,names.arg = names(counts), main="Race distribution of all years among Males", col=c("red"),
  beside=TRUE)
```
**Compared with "black" and "white", the rest of the races take over only a small proportion of the sample, which is too samll to do analysis, so we drop them**

I know we are focusing only white men, but**I keep both black and white for now**
```{r}
yy<-which(DF2$Defendant.Race == "BLACK")
yyy<-which(DF2$Defendant.Race == "WHITE")
DF3<- DF2[c(yy,yyy), ]
tail(DF3)[,2:6]
```
```{r}
#barplot(table(DF3$Arrest.Year=="2021"))
```


**Distibution of crime type (Arrest.Category)**

There are plenty of crime categories, we only do analysis of the top crimes.
```{r} 
counts_cat <- table(DF3$Arrest.Category)
barplot(counts_cat,las=3,names.arg = names(counts_cat),cex.names=0.4, main="Arrest Category", col=c("red"),density = 32,angle = 45,border = TRUE, plot = TRUE,cex.main=0.3,cex.axis = 0.3,font.main=3,ylim=c(0, 10000))

```

category by years
```{r}
DF_2016<- DF3[DF3$Arrest.Year == "2016", ]
DF_2017 <- DF3[DF3$Arrest.Year == "2017", ]
DF_2018 <- DF3[DF3$Arrest.Year == "2018", ]
DF_2019 <- DF3[DF3$Arrest.Year == "2019", ]
DF_2020 <- DF3[DF3$Arrest.Year == "2020", ]
DF_2021 <- DF3[DF3$Arrest.Year == "2021", ]
```

### Crime distribution
filter the top crimes of every year
```{r }
#df_ls<-list("DF_2016","DF_2017","DF_2018","DF_2019","DF_2020","DF_2021")
#top_crime_ls<-list(x = 1:6)
#for( i in 1:6){
#  counts_cat_tmp <- table(df_ls[i]$Arrest.Category)
#  pos_tmp<-order(counts_cat_tmp ,decreasing=TRUE)[1:6]
#  top_crime_ls[i]<-names(counts_cat_tmp)[pos]}

#2016 top
cnt_2016<-table(DF_2016$Arrest.Category)
pos_2016<-order(cnt_2016,decreasing=TRUE)[1:6]
crime_2016<-names(cnt_2016)[pos_2016]
#2017 top
cnt_2017<-table(DF_2017$Arrest.Category)
pos_2017<-order(cnt_2017,decreasing=TRUE)[1:6]
crime_2017<-names(cnt_2017)[pos_2017]
#2018 top
cnt_2018<-table(DF_2018$Arrest.Category)
pos_2018<-order(cnt_2018,decreasing=TRUE)[1:6]
crime_2018<-names(cnt_2018)[pos_2018]
#2019 top
cnt_2019<-table(DF_2019$Arrest.Category)
pos_2019<-order(cnt_2019,decreasing=TRUE)[1:6]
crime_2019<-names(cnt_2019)[pos_2019]
#2020 top
cnt_2020<-table(DF_2020$Arrest.Category)
pos_2020<-order(cnt_2020,decreasing=TRUE)[1:6]
crime_2020<-names(cnt_2020)[pos_2020]
#2021 top
cnt_2021<-table(DF_2021$Arrest.Category)
pos_2021<-order(cnt_2021,decreasing=TRUE)[1:6]
crime_2021<-names(cnt_2021)[pos_2021]

```
The top several crime among "white(and black)" males of every year is 
2016 `r crime_2016``

2017 **`r crime_2017`**

2018 **`r crime_2018`**

2019 **`r crime_2019`**

2020 **`r crime_2020`**

2021 **`r crime_2021`**


### Crime trend for specific category
#### Make a new dataframe to collect the counts of the crimes of interest of all years among white males
Note: 1. I don't know if we are supposed to consider "Other Crimes", cause IDK how  to explain it. I added it for now
      2. I added "Theft" "Narcotics", though they don't appear in top 6 in  every year,they still account for a significant proportion

code for creating a new dataframe
```{r}
#WHITE "Simple Assault"
SIM_WHITE<-list()

SIM_WHITE<-table(DF_2016$Arrest.Category[DF_2016$Defendant.Race=="WHITE"]=="Simple Assault")["TRUE"]%>%sum()%>%append(SIM_WHITE, )

SIM_WHITE<-table(DF_2017$Arrest.Category[DF_2017$Defendant.Race=="WHITE"]=="Simple Assault")["TRUE"]%>%sum()%>%append(SIM_WHITE, )

SIM_WHITE<-table(DF_2018$Arrest.Category[DF_2018$Defendant.Race=="WHITE"]=="Simple Assault")["TRUE"]%>%sum()%>%append(SIM_WHITE, )

SIM_WHITE<-table(DF_2019$Arrest.Category[DF_2019$Defendant.Race=="WHITE"]=="Simple Assault")["TRUE"]%>%sum()%>%append(SIM_WHITE, )

SIM_WHITE<-table(DF_2020$Arrest.Category[DF_2020$Defendant.Race=="WHITE"]=="Simple Assault")["TRUE"]%>%sum()%>%append(SIM_WHITE, )

SIM_WHITE<-table(DF_2021$Arrest.Category[DF_2021$Defendant.Race=="WHITE"]=="Simple Assault")["TRUE"]%>%sum()%>%append(SIM_WHITE, )

SIM_WHITE<-c(SIM_WHITE[[1]],SIM_WHITE[[2]],SIM_WHITE[[3]],SIM_WHITE[[4]],SIM_WHITE[[5]],SIM_WHITE[[6]])
```

```{r}
#Release Violations/Fugitive
RVF_WHITE<-list()

RVF_WHITE<-table(DF_2016$Arrest.Category[DF_2016$Defendant.Race=="WHITE"]=="Release Violations/Fugitive")["TRUE"]%>%sum()%>%append(RVF_WHITE, )

RVF_WHITE<-table(DF_2017$Arrest.Category[DF_2017$Defendant.Race=="WHITE"]=="Release Violations/Fugitive")["TRUE"]%>%sum()%>%append(RVF_WHITE, )

RVF_WHITE<-table(DF_2018$Arrest.Category[DF_2018$Defendant.Race=="WHITE"]=="Release Violations/Fugitive")["TRUE"]%>%sum()%>%append(RVF_WHITE, )

RVF_WHITE<-table(DF_2019$Arrest.Category[DF_2019$Defendant.Race=="WHITE"]=="Release Violations/Fugitive")["TRUE"]%>%sum()%>%append(RVF_WHITE, )

RVF_WHITE<-table(DF_2020$Arrest.Category[DF_2020$Defendant.Race=="WHITE"]=="Release Violations/Fugitive")["TRUE"]%>%sum()%>%append(RVF_WHITE, )

RVF_WHITE<-table(DF_2021$Arrest.Category[DF_2021$Defendant.Race=="WHITE"]=="Release Violations/Fugitive (Warr)")["TRUE"]%>%sum()%>%append(RVF_WHITE, )

RVF_WHITE<-c(RVF_WHITE[[1]],RVF_WHITE[[2]],RVF_WHITE[[3]],RVF_WHITE[[4]],RVF_WHITE[[5]],RVF_WHITE[[6]])
```




```{r}
#Traffic Violations
TRA_WHITE<-list()

TRA_WHITE<-table(DF_2016$Arrest.Category[DF_2016$Defendant.Race=="WHITE"]=="Traffic Violations")["TRUE"]%>%sum()%>%append(TRA_WHITE, )

TRA_WHITE<-table(DF_2017$Arrest.Category[DF_2017$Defendant.Race=="WHITE"]=="Traffic Violations")["TRUE"]%>%sum()%>%append(TRA_WHITE, )

TRA_WHITE<-table(DF_2018$Arrest.Category[DF_2018$Defendant.Race=="WHITE"]=="Traffic Violations")["TRUE"]%>%sum()%>%append(TRA_WHITE, )

TRA_WHITE<-table(DF_2019$Arrest.Category[DF_2019$Defendant.Race=="WHITE"]=="Traffic Violations")["TRUE"]%>%sum()%>%append(TRA_WHITE, )

TRA_WHITE<-table(DF_2020$Arrest.Category[DF_2020$Defendant.Race=="WHITE"]=="Traffic Violations")["TRUE"]%>%sum()%>%append(TRA_WHITE, )

TRA_WHITE<-table(DF_2021$Arrest.Category[DF_2021$Defendant.Race=="WHITE"]=="Traffic Violations")["TRUE"]%>%sum()%>%append(TRA_WHITE, )

TRA_WHITE<-c(TRA_WHITE[[1]],TRA_WHITE[[2]],TRA_WHITE[[3]],TRA_WHITE[[4]],TRA_WHITE[[5]],TRA_WHITE[[6]])
```


```{r}
#Narcotics
NAR_WHITE<-list()

NAR_WHITE<-table(DF_2016$Arrest.Category[DF_2016$Defendant.Race=="WHITE"]=="Narcotics")["TRUE"]%>%sum()%>%append(NAR_WHITE, )

NAR_WHITE<-table(DF_2017$Arrest.Category[DF_2017$Defendant.Race=="WHITE"]=="Narcotics")["TRUE"]%>%sum()%>%append(NAR_WHITE, )

NAR_WHITE<-table(DF_2018$Arrest.Category[DF_2018$Defendant.Race=="WHITE"]=="Narcotics")["TRUE"]%>%sum()%>%append(NAR_WHITE, )

NAR_WHITE<-table(DF_2019$Arrest.Category[DF_2019$Defendant.Race=="WHITE"]=="Narcotics")["TRUE"]%>%sum()%>%append(NAR_WHITE, )

NAR_WHITE<-table(DF_2020$Arrest.Category[DF_2020$Defendant.Race=="WHITE"]=="Narcotics")["TRUE"]%>%sum()%>%append(NAR_WHITE, )

NAR_WHITE<-table(DF_2021$Arrest.Category[DF_2021$Defendant.Race=="WHITE"]=="Narcotics")["TRUE"]%>%sum()%>%append(NAR_WHITE, )

NAR_WHITE<-c(NAR_WHITE[[1]],NAR_WHITE[[2]],NAR_WHITE[[3]],NAR_WHITE[[4]],NAR_WHITE[[5]],NAR_WHITE[[6]])
```


```{r}
#Theft
THEFT_WHITE<-list()

THEFT_WHITE<-table(DF_2016$Arrest.Category[DF_2016$Defendant.Race=="WHITE"]=="Theft")["TRUE"]%>%sum()%>%append(THEFT_WHITE, )

THEFT_WHITE<-table(DF_2017$Arrest.Category[DF_2017$Defendant.Race=="WHITE"]=="Theft")["TRUE"]%>%sum()%>%append(THEFT_WHITE, )

THEFT_WHITE<-table(DF_2018$Arrest.Category[DF_2018$Defendant.Race=="WHITE"]=="Theft")["TRUE"]%>%sum()%>%append(THEFT_WHITE, )

THEFT_WHITE<-table(DF_2019$Arrest.Category[DF_2019$Defendant.Race=="WHITE"]=="Theft")["TRUE"]%>%sum()%>%append(THEFT_WHITE, )

THEFT_WHITE<-table(DF_2020$Arrest.Category[DF_2020$Defendant.Race=="WHITE"]=="Theft")["TRUE"]%>%sum()%>%append(THEFT_WHITE, )

THEFT_WHITE<-table(DF_2021$Arrest.Category[DF_2021$Defendant.Race=="WHITE"]=="Theft")["TRUE"]%>%sum()%>%append(THEFT_WHITE, )

THEFT_WHITE<-c(THEFT_WHITE[[1]],THEFT_WHITE[[2]],THEFT_WHITE[[3]],THEFT_WHITE[[4]],THEFT_WHITE[[5]],THEFT_WHITE[[6]])
```


```{r}
#Other Crimes
OTH_WHITE<-list()

OTH_WHITE<-table(DF_2016$Arrest.Category[DF_2016$Defendant.Race=="WHITE"]=="Other Crimes")["TRUE"]%>%sum()%>%append(OTH_WHITE, )

OTH_WHITE<-table(DF_2017$Arrest.Category[DF_2017$Defendant.Race=="WHITE"]=="Other Crimes")["TRUE"]%>%sum()%>%append(OTH_WHITE, )

OTH_WHITE<-table(DF_2018$Arrest.Category[DF_2018$Defendant.Race=="WHITE"]=="Other Crimes")["TRUE"]%>%sum()%>%append(OTH_WHITE, )

OTH_WHITE<-table(DF_2019$Arrest.Category[DF_2019$Defendant.Race=="WHITE"]=="Other Crimes")["TRUE"]%>%sum()%>%append(OTH_WHITE, )

OTH_WHITE<-table(DF_2020$Arrest.Category[DF_2020$Defendant.Race=="WHITE"]=="Other Crimes")["TRUE"]%>%sum()%>%append(OTH_WHITE, )

OTH_WHITE<-table(DF_2021$Arrest.Category[DF_2021$Defendant.Race=="WHITE"]=="Other Crimes")["TRUE"]%>%sum()%>%append(OTH_WHITE, )

OTH_WHITE<-c(OTH_WHITE[[1]],OTH_WHITE[[2]],OTH_WHITE[[3]],OTH_WHITE[[4]],OTH_WHITE[[5]],OTH_WHITE[[6]])
```


This is the DataFrame of top crimes among white males, 
colnames are **"Simple Assault", "Release Violations/Fugitive", "Traffic Violations", "Narcotics", "Theft", "Other Crimes"**
```{r}
x_year<-c(seq(2016, 2021, by=1))

DF_white<-data.frame(x_year,SIM_WHITE,RVF_WHITE,TRA_WHITE,NAR_WHITE,THEFT_WHITE,OTH_WHITE)
DF_white
#xkablesummary(DF_white)

```
```{r}
library(ggplot2)
 
#color_ls<-list("darkorange","darkorange1","darkorange2","darkorange3","darkorange4","darkolivegreen4")
ggplot()+geom_line(data = DF_white,aes(x = x_year,y = SIM_WHITE,colour = "Simple Assault"),size=1)+
  geom_point(data =  DF_white,aes(x = x_year,y = SIM_WHITE,colour = "Simple Assault"),size=3)+
  
  geom_line(data =  DF_white,aes(x = x_year,y = RVF_WHITE,colour ="Release Violations/Fugitive"),size=1) + 
  geom_point(data =  DF_white,aes(x = x_year,y = RVF_WHITE,colour = "Release Violations/Fugitive"),size=3)+
  
  geom_line(data =  DF_white,aes(x = x_year,y = TRA_WHITE,colour ="Traffic Violations"),size=1) + 
  geom_point(data =  DF_white,aes(x = x_year,y = TRA_WHITE,colour = "Traffic Violations"),size=3)+
  
  geom_line(data =  DF_white,aes(x = x_year,y = NAR_WHITE,colour ="Narcotics"),size=1) + 
  geom_point(data =  DF_white,aes(x = x_year,y = NAR_WHITE,colour = "Narcotics"),size=3)+
  
  geom_line(data =  DF_white,aes(x = x_year,y = THEFT_WHITE,colour ="Theft"),size=1) + 
  geom_point(data =  DF_white,aes(x = x_year,y = THEFT_WHITE,colour = "Theft"),size=3)+
  
  geom_line(data =  DF_white,aes(x = x_year,y =OTH_WHITE,colour ="Other Crimes"),size=1) + 
  geom_point(data =  DF_white,aes(x = x_year,y = OTH_WHITE,colour = "Other Crimes"),size=3)+
  
  scale_colour_manual("",values = c("darkolivegreen","darkolivegreen1","darkolivegreen2","darkolivegreen3","darkolivegreen4","darkorange"))+
  xlab("Year")+ylab("CRIME COUNTS")+ ggtitle("CRIME TREND IN DC \n from 2016 to 2021 among white males")+
  theme(plot.title = element_text(lineheight = .8,size = 14, face = "bold.italic"))+
  theme(axis.title.x = element_text(vjust = 2, size = 12),
        axis.title.y = element_text(vjust = 2, size = 12))+
 theme(panel.grid.major = element_line(color = "gray10", size = .5),
        panel.grid.minor = element_line(color = "gray70", size = .25))


```



We can also goup them by ages like 20-30, 30-40....